#!/bin/bash

export WINEPREFIX="${HOME}/Games/magic-the-gathering-arena/"
export WINEARCH='win64'
export WINEDEBUG='-all'

export INSTALLER_URL='https://mtgarena.downloads.wizards.com/Live/Windows32/versions/1684.728405/MTGAInstaller_0.1.1684.728405.msi'
export INSTALLER_BIN=$(basename $INSTALLER_URL)

if [ $# -ne 0 ]
then
  if [ "${1}" == "reinstall" ]
  then
    echo "Reinstalling.."
    cp $WINEPREFIX/user.reg /tmp/
    rm -rf $WINEPREFIX
    mkdir $WINEPREFIX
    mv /tmp/user.reg $WINEPREFIX
    cd $WINEPREFIX
    wget $INSTALLER_URL
    wine msiexec /i $INSTALLER_BIN
  elif [ "${1}" == "download" ]
  then
    export WINEDEBUG='+relay,-debug'
    export GC_DONT_GC=1
    wine "${WINEPREFIX}/drive_c/Program Files (x86)/Wizards of the Coast/MTGA/MTGA.exe"
  else
    $@
  fi
else
  wine "${WINEPREFIX}/drive_c/Program Files (x86)/Wizards of the Coast/MTGA/MTGA.exe"
fi
