#!/bin/bash
#
# Usage:
#   install/reinstall:
#   $ mtga reinstall https://mtgarena.downloads.wizards.com/Live/Windows32/versions/1968.747022/MTGAInstaller_0.1.1968.747022.msi
#   run:
#   $ mtga
#   execute something else in the prefix:
#   $ mtga <command>
#

export WINEPREFIX="${HOME}/Games/magic-the-gathering-arena/"
export WINEARCH='win64'
export WINEDEBUG='-all'

if [ $# -ne 0 ]
then
  if [ "${1}" == "reinstall" ]
  then
    echo "Reinstalling.."
    INSTALLER_URL=$2
    INSTALLER_BIN=$(basename $INSTALLER_URL)
    cp $WINEPREFIX/user.reg /tmp/
    rm -rf $WINEPREFIX
    mkdir $WINEPREFIX
    mv /tmp/user.reg $WINEPREFIX
    cd $WINEPREFIX
    wget $INSTALLER_URL
    wine msiexec /i $INSTALLER_BIN
  elif [ "${1}" == "download" ]
  then
    export WINEDEBUG='+relay,-debug'
    export GC_DONT_GC=1
    wine "${WINEPREFIX}/drive_c/Program Files (x86)/Wizards of the Coast/MTGA/MTGA.exe"
  else
    $@
  fi
else
  wine "${WINEPREFIX}/drive_c/Program Files (x86)/Wizards of the Coast/MTGA/MTGA.exe"
fi
